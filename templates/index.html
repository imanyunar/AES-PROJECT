<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AES S-Box Encryption Suite</title>

<style>
/* ============ RESET ============ */
*{margin:0;padding:0;box-sizing:border-box}

/* ============ BASE ============ */
body{
    font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
    background:linear-gradient(135deg,#667eea,#764ba2);
    padding:20px;
    min-height:100vh;
    animation:fadeIn 1s ease;
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

.container{
    max-width:1200px;
    margin:auto;
    background:#fff;
    border-radius:16px;
    box-shadow:0 15px 50px rgba(0,0,0,.25);
    padding:30px;
    animation:slideUp .8s ease;
}
@keyframes slideUp{
    from{transform:translateY(30px);opacity:0}
    to{transform:translateY(0);opacity:1}
}

h1{text-align:center;color:#667eea;margin-bottom:6px}
.subtitle{text-align:center;color:#666;margin-bottom:25px}

/* ============ FORM ============ */
.form-section{
    background:#f8f9fa;
    padding:25px;
    border-radius:12px;
    margin-bottom:25px;
}

label{font-weight:600;margin-bottom:6px;display:block}

input,select{
    width:100%;
    padding:12px;
    border:2px solid #ddd;
    border-radius:8px;
    margin-bottom:15px;
}

input:focus,select:focus{
    outline:none;
    border-color:#667eea;
}

.button-group{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}

button{
    padding:12px 20px;
    border:none;
    border-radius:8px;
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:white;
    font-weight:600;
    cursor:pointer;
    transition:.25s;
}
button:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 18px rgba(0,0,0,.2);
}

/* ============ METRICS ============ */
.metrics-section{
    background:#fff3cd;
    border-left:5px solid #ffc107;
    padding:20px;
    border-radius:12px;
    animation:fadeIn .6s ease;
}

.metric-item{
    background:#fff;
    padding:14px;
    border-radius:10px;
    margin-bottom:14px;
    animation:slideUp .4s ease;
}

.metric-header{
    display:flex;
    justify-content:space-between;
    font-weight:600;
}

.metric-score{color:#4caf50}
.metric-status{font-size:.85em;color:#666;margin:4px 0}

.progress{
    height:12px;
    background:#e0e0e0;
    border-radius:6px;
    overflow:hidden;
}

.progress-bar{
    height:100%;
    background:linear-gradient(90deg,#4caf50,#81c784);
    width:0;
    transition:width 1s ease;
}

/* ============ SBOX VIEWER ============ */
.sbox-section{
    background:#f3e5f5;
    border-left:5px solid #9c27b0;
    padding:20px;
    border-radius:12px;
    margin-top:25px;
}

.sbox-controls{
    margin-bottom:10px;
}

.sbox-controls button{
    background:#9c27b0;
}

.sbox-grid{
    display:grid;
    grid-template-columns:repeat(16,1fr);
    gap:5px;
}

.sbox-cell{
    background:#fff;
    padding:6px;
    text-align:center;
    border-radius:6px;
    font-family:monospace;
    font-size:.75em;
    animation:fadeIn .3s ease;
}

/* ============ STATISTICS ============ */
.statistics-section{
    background:#e3f2fd;
    border-left:5px solid #2196f3;
    padding:20px;
    border-radius:12px;
    margin-top:25px;
}

/* ============ RESPONSIVE ============ */
@media(max-width:768px){
    .button-group{flex-direction:column}
    button{width:100%}
}
</style>
</head>

<body>
<div class="container">

<h1>üîê AES S-Box Encryption Suite</h1>
<p class="subtitle">Advanced Encryption Standard with Custom S-Box Analysis</p>

<form method="POST">
<div class="form-section">

<label>Select S-Box</label>
<select name="sbox_choice" id="sbox_choice">
<option value="AES">AES</option>
<option value="A0">A0</option>
<option value="A1">A1</option>
<option value="A2">A2</option>
<option value="K4">K4</option>
<option value="K44">K44</option>
<option value="K128">K128</option>
<option value="RANDOM">Random</option>
</select>

<label>Plaintext / Ciphertext</label>
<input type="text" name="plaintext" value="{{ plaintext }}">

<label>Key</label>
<input type="text" name="key"
placeholder="e.g. MySecretKey or 4d79536563726574"
value="{{ key }}">

<div class="button-group">
<button name="action" value="Encrypt">Encrypt</button>
<button name="action" value="Decrypt">Decrypt</button>
<button name="action" value="Show Metrics">Show Metrics</button>
</div>

</div>
</form>

{% if metrics and metric_scores %}
<div class="metrics-section">
<h3>üìä Cryptographic Scores</h3>

{% for k,v in metrics.items() %}
<div class="metric-item">
<div class="metric-header">
<span>{{ k }}</span>
<span class="metric-score">{{ metric_scores[k] }}/100</span>
</div>

<div class="metric-status">
{% if metric_scores[k] >= 90 %}Excellent
{% elif metric_scores[k] >= 75 %}Good
{% elif metric_scores[k] >= 60 %}Fair
{% else %}Poor{% endif %}
</div>

<div class="progress">
<div class="progress-bar" data-width="{{ metric_scores[k] }}"></div>
</div>
</div>
{% endfor %}

<p><strong>Overall Score:</strong> {{ "%.2f"|format(overall_score) }}</p>
<p><strong>Grade:</strong> {{ grade }}</p>
</div>
{% endif %}

<div class="sbox-section">
<h3>üî¢ S-Box Viewer</h3>
<div class="sbox-controls">
<button type="button" onclick="loadSBox('hex')">HEX</button>
<button type="button" onclick="loadSBox('dec')">DEC</button>
</div>
<div id="sboxGrid" class="sbox-grid"></div>
</div>

<div class="statistics-section">
<h3>üìà Global Statistics</h3>
<div id="statistics-container">Loading...</div>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  document.querySelectorAll(".progress-bar").forEach(bar=>{
    bar.style.width = bar.dataset.width + "%";
  });
  loadSBox("hex");
  loadStatistics();
});

function loadSBox(fmt){
  const sbox = document.getElementById("sbox_choice").value;
  fetch(`/api/sbox-data/${sbox}`)
  .then(r=>r.json())
  .then(d=>{
    const grid=document.getElementById("sboxGrid");
    grid.innerHTML="";
    const arr = fmt==="hex" ? d.hex : d.dec;
    arr.flat().forEach(v=>{
      const c=document.createElement("div");
      c.className="sbox-cell";
      c.textContent=v;
      grid.appendChild(c);
    });
  });
}

function loadStatistics(){
  fetch("/api/statistics")
  .then(r=>r.json())
  .then(d=>{
    let html="";
    for(const [k,v] of Object.entries(d.statistics)){
      html+=`<p><strong>${k}</strong> ‚Üí mean: ${v.mean.toFixed(4)}</p>`;
    }
    document.getElementById("statistics-container").innerHTML=html;
  });
}
</script>

</body>
</html>
